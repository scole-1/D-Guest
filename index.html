<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Wedding Guestbook</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<style>
:root {
  --accent: #22c55e;
}

* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
}

body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-image:
    linear-gradient(rgba(0,0,0,.6), rgba(0,0,0,.6)),
    url("https://images.unsplash.com/photo-1520854221256-17451cc331bf");
  color: #fff;
  overflow: hidden;
}

.container {
  max-width: 520px;
  margin: auto;
  padding: 24px;
  height: 100%;
  display: flex;
  align-items: center;
}

.card {
  width: 100%;
  background: rgba(2,6,23,.88);
  backdrop-filter: blur(14px);
  border-radius: 24px;
  padding: 26px;
  box-shadow: 0 25px 50px rgba(0,0,0,.6);
  animation: enter .45s ease;
}

@keyframes enter {
  from { opacity: 0; transform: translateY(14px); }
  to { opacity: 1; transform: translateY(0); }
}

h1, h2 {
  text-align: center;
  margin-bottom: 16px;
}

p.center {
  text-align: center;
  opacity: .9;
}

button {
  width: 100%;
  padding: 18px;
  border-radius: 999px;
  border: none;
  font-size: 17px;
  font-weight: 600;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: transform .15s ease;
}

button:active {
  transform: scale(.96);
}

button::after {
  content: "";
  position: absolute;
  width: 120px;
  height: 120px;
  background: rgba(255,255,255,.35);
  border-radius: 50%;
  transform: scale(0);
  opacity: 0;
  pointer-events: none;
}

button:active::after {
  animation: ripple .5s ease;
}

@keyframes ripple {
  from {
    transform: scale(0);
    opacity: .7;
  }
  to {
    transform: scale(3);
    opacity: 0;
  }
}

.primary {
  background: var(--accent);
  color: #022c22;
}

.secondary {
  background: transparent;
  border: 1px solid rgba(255,255,255,.35);
  color: #fff;
}

.small-skip {
  position: absolute;
  top: 14px;
  right: 16px;
  font-size: 13px;
  opacity: .45;
  cursor: pointer;
}

.small-skip:hover {
  opacity: .85;
}

input {
  width: 100%;
  padding: 15px 18px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.3);
  background: rgba(0,0,0,.45);
  color: #fff;
  font-size: 16px;
}

.preview {
  width: 100%;
  max-height: 260px;
  object-fit: cover;
  border-radius: 18px;
  margin-bottom: 14px;
}

.notice {
  text-align: center;
  font-size: 13px;
  opacity: .7;
  margin-top: 10px;
}

.list-item {
  padding: 15px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.3);
  margin: 6px 0;
  cursor: pointer;
}

.list-item:hover {
  background: rgba(255,255,255,.08);
}

.screen {
  display: none;
}

.screen.active {
  display: block;
}

#wallBtn {
  position: fixed;
  bottom: 14px;
  left: 14px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,.45);
  color: #fff;
  font-size: 16px;
  cursor: pointer;
  backdrop-filter: blur(6px);
}
</style>
</head>

<body>

<button id="wallBtn" onclick="changeWallpaper()">üñºÔ∏è</button>

<div class="container">

<!-- MAIN -->
<div id="main" class="screen active">
  <div class="card">
    <div class="small-skip" onclick="go('search')">Skip</div>
    <h1>Welcome</h1>
    <p class="center">Capture a beautiful memory with us</p>
    <button class="primary" onclick="openCamera()">üì∏ Take Photo</button>
  </div>
</div>

<!-- PHOTO -->
<div id="photo" class="screen">
  <div class="card">
    <h2>Your Photo</h2>
    <img id="photoPreview" class="preview" />
    <input id="nameInput" placeholder="Your name" />
    <button class="primary" onclick="submitPhoto()" style="margin-top:14px">Done</button>
    <button class="secondary" onclick="go('main')" style="margin-top:8px">Cancel</button>
  </div>
</div>

<!-- SEARCH -->
<div id="search" class="screen">
  <div class="card">
    <h2>Find Your Name</h2>
    <input id="searchInput" placeholder="Type your name" oninput="searchGuest()" />
    <div id="results"></div>
    <button class="secondary" onclick="go('main')" style="margin-top:12px">Back</button>
  </div>
</div>

<!-- THANK YOU -->
<div id="thanks" class="screen">
  <div class="card">
    <img id="thanksPhoto" class="preview" />
    <p class="center">
      Thank you for being part of our story üíç<br />
      Your presence means the world to us.
    </p>
  </div>
</div>

</div>

<input type="file" id="cameraInput" accept="image/*" capture="environment" hidden />

<script>
/* CONFIG */
const API_BASE = "/.netlify/functions";

/* STATE */
let photoFile = null;
let locked = false;

/* WALLPAPER */
const wallpapers = [
  "https://images.unsplash.com/photo-1520854221256-17451cc331bf",
  "https://images.unsplash.com/photo-1519741497674-611481863552",
  "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e"
];

let wallIndex = 0;

function changeWallpaper() {
  wallIndex = (wallIndex + 1) % wallpapers.length;
  document.body.style.backgroundImage =
    `linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),url('${wallpapers[wallIndex]}')`;
}

setInterval(changeWallpaper, 180000);

/* NAV */
function go(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* CAMERA */
function openCamera() {
  if (locked) return;
  document.getElementById("cameraInput").click();
}

cameraInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  photoFile = file;
  new Audio("https://actions.google.com/sounds/v1/camera/camera_shutter_click_01.mp3").play();
  const r = new FileReader();
  r.onload = () => {
    photoPreview.src = r.result;
    go("photo");
  };
  r.readAsDataURL(file);
};

/* SUBMIT */
async function submitPhoto() {
  if (locked) return;
  locked = true;

  const name = nameInput.value.trim();
  if (!name || !photoFile) {
    locked = false;
    return alert("Please enter your name");
  }

  const fd = new FormData();
  fd.append("name", name);
  fd.append("photo", photoFile);

  await fetch(API_BASE + "/sign-with-photo", { method: "POST", body: fd });
  showThanks(photoPreview.src);
}

/* SEARCH */
async function searchGuest() {
  const q = searchInput.value.trim();
  if (!q) return results.innerHTML = "";

  const res = await fetch(API_BASE + "/search-guest?query=" + encodeURIComponent(q));
  const data = await res.json();
  results.innerHTML = "";

  data.forEach(g => {
    const d = document.createElement("div");
    d.className = "list-item";
    d.textContent = g.name;
    d.onclick = async () => {
      if (locked) return;
      locked = true;
      await fetch(API_BASE + "/mark-signed", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id: g.id })
      });
      showThanks(null);
    };
    results.appendChild(d);
  });
}

/* THANK YOU */
function showThanks(photo) {
  if (photo) {
    thanksPhoto.src = photo;
    thanksPhoto.style.display = "block";
  } else {
    thanksPhoto.style.display = "none";
  }
  go("thanks");
  setTimeout(resetAll, 3800);
}

function resetAll() {
  locked = false;
  photoFile = null;
  cameraInput.value = "";
  nameInput.value = "";
  searchInput.value = "";
  results.innerHTML = "";
  go("main");
}
</script>

</body>
</html>
